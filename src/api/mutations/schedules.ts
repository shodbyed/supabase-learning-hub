/**
 * @fileoverview Schedule Mutation Functions
 *
 * Pure functions for schedule/match generation and deletion operations.
 * These functions are wrapped by TanStack Query mutation hooks.
 *
 * Schedules are generated by:
 * - Taking team positions (1-N)
 * - Applying matchup table logic for round-robin scheduling
 * - Creating match records for each week of the season
 *
 * @see api/hooks/useScheduleMutations.ts - Mutation hooks that wrap these functions
 */

import { generateSchedule as utilGenerateSchedule, clearSchedule as utilClearSchedule } from '@/utils/scheduleGenerator';
import type { TeamWithPosition } from '@/types/schedule';

/**
 * Parameters for generating a schedule
 */
export interface GenerateScheduleParams {
  seasonId: string;
  teams: TeamWithPosition[];
  skipExistingCheck?: boolean;
}

/**
 * Parameters for deleting a schedule
 */
export interface DeleteScheduleParams {
  seasonId: string;
}

/**
 * Result from schedule generation
 */
export interface ScheduleResult {
  success: boolean;
  matchesCreated: number;
  error?: string;
}

/**
 * Result from schedule deletion
 */
export interface DeleteScheduleResult {
  success: boolean;
  matchesDeleted: number;
  error?: string;
}

/**
 * Generate a full season schedule
 *
 * Creates match records for all regular season weeks based on:
 * - Team positions (determines matchups via matchup table)
 * - Season weeks (determines dates)
 * - Matchup table (determines which teams play each week)
 *
 * @param params - Schedule generation parameters
 * @returns Result with success status and match count
 * @throws Error if validation fails or database operation fails
 */
export async function generateScheduleMutation(params: GenerateScheduleParams): Promise<ScheduleResult> {
  return await utilGenerateSchedule(params);
}

/**
 * Delete all matches for a season
 *
 * Removes all match records for the specified season.
 * Use this before regenerating a schedule.
 *
 * @param params - Schedule deletion parameters
 * @returns Result with success status and deleted match count
 * @throws Error if database operation fails
 */
export async function deleteSchedule(params: DeleteScheduleParams): Promise<DeleteScheduleResult> {
  return await utilClearSchedule(params.seasonId);
}
